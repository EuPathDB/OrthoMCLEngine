#!/usr/bin/perl
use strict;

usage() unless scalar(@ARGV) == 2;

my ($groupsFile, $proteinRelativeScoresFile) = @ARGV;

open(P, $proteinRelativeScoresFile) || die "Could not open file '$proteinRelativeScoresFile'\n";
my %proteinScores;
while(<P>) {
  chomp;
  my @p = split;
  my $id = shift(@p);
  $proteinScores{$id} = \@p;
}
close(P);

open(G, $groupsFile) || die "Could not open file '$groupsFile'\n";

while(<G>) {
  chomp;

  my @g = split;
  my $id = shift @g;
  my $maxScore = 0;
  my $minScore = 0;
  my $scoreSum;
  foreach my $member (@g) {
    next unless $proteinScores{$member};
    my ($score, $avgScore) = @{$proteinScores{$member}};
    $minScore = $avgScore if $avgScore < $minScore;
    $maxScore = $avgScore if $avgScore > $maxScore;
    $scoreSum += $avgScore;
  }
  my $scoreDiv = $scoreSum / scalar(@g);
  print sprintf("$id $minScore $maxScore $scoreSum %.4f\n", $scoreDiv);
}


sub usage {

die "
Make file showing relative protein scores for groups w/ changed proteins.

usage:  orthomclMakeScoresFile groupsFile relative_protein_scores

output file has:
group_id minProteinScore maxProteinScore summedProteinScores avgProteinScores
";

}
