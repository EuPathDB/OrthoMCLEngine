#!/usr/bin/perl
use strict;
my $allGroups = $ARGV[0];
my $diffGroups = $ARGV[1];

usage() unless scalar(@ARGV) == 2;

open(ALL, $allGroups) || die "cant open $allGroups\n";
my $count;
my %protein2clade;
while(<ALL>) {
  chomp;
  my @a = split(/ /);
  shift @a;
  my %clades;
  my $isMerged;
  foreach my $member (@a) {
      my @b = split(/\|/, @a);
      $protein2clade{"$b[1]|$b[2]"} = $b[0];
      $isMerged = $clades{$b[0]};
      $clades{$b[0]} = 1 ;
  }
  $count++ if $isMerged;
}
close(ALL);
print "All: $count\n";

open(DIFF, $diffGroups) || die "cant open $allGroups\n";
$count = 0;
while(<DIFF>) {
  chomp;
  my @a = split(/ /);
  shift @a;
  my %clades;
  my $isMerged;
  foreach my $member (@a) {
      my $clade = $protein2clade{$member};
      $isMerged = $clades{$clade};
      $clades{$clade} = 1 ;
  }
  $count++ if $isMerged;
}
close(DIFF);
print "Diff: $count\n";

sub usage {
  die "

Count the number of Tier 2 groups that include more than one Tier 1 representative proteins.

Provide counts for all groups and those that differ from a reference build.

Usage: orthomclCountMergedTier1
";

}
